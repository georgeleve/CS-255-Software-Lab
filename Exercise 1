/* Georgios Gerasimos Leventopoulos   */       
/* csd4152  Assignment 1  translate.c */

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

/* This function matches the iso8859-7 with  iso8859-1 characters and return their position in the array. */
int matchCharacter(int id) {
	/* Common cases */
	/* Low case letters (a-z) */
	if (id >= 225 && id <= 249) {
		return id - 225 + 0;
	}
	/* Upper case letters (A-R) */
	else if (id >= 193 && id <= 209) {
		return id - 193 + 25;
	}
	/* Upper case letters. (S-W) */
	else if (id >= 211 && id <= 217) {
		return id - 211 + 42;
	}
	/* Special Cases: */
	/*Upper case with accent*/
	if (id == 182)return 49; /* "A'" */
	if (id == 184)return 50; /* "E'" */
	if (id == 185)return 51; /* "H'" */
	if (id == 186)return 52; /* "I'" */
	if (id == 188)return 53; /* "O'" */
	if (id == 190)return 54; /* "Y'" */
	if (id == 191)return 55; /* "W'" */
	/*Low case with accent */
	if (id == 220) return 56; /* a' */
	if (id == 221) return 57; /* e' */
	if (id == 222) return 58; /* h' */
	if (id == 223) return 59; /* i' */
	if (id == 252) return 60; /* o' */
	if (id == 253) return 61; /* y' */
	if (id == 254) return 62; /* w' */
	/*Special low case with accent */
	if (id == 250) return 63; /* i''  */
	if (id == 251) return 64; /* y''  */
	if (id == 253) return 65; /* i`'' */
	if (id == 254) return 66; /* y`'' */
	return -5; /* The letter is the same in both iso and we do not need to translate it. */
}
/* This method prints characters in stdout (in the console). */
void print_character(char * character) {
	/*printf(character); Prints the pointer as it is.*/
	while (*character) {
		putchar(*character);
		character = character + 1;
	}
}
/*This method puts the iso8859-1 characters that we need to translate 
   in the array in order to print them later.*/
void putCharactersInTheArray(char * index[]) {
	/* Low case letters (225-249 in iso8859_7) */
	index[0] = "a";
	index[1] = "v";
	index[2] = "g";
	index[3] = "d";
	index[4] = "e";
	index[5] = "z";
	index[6] = "h";
	index[7] = "8";
	index[8] = "i";
	index[9] = "k";
	index[10] = "l";
	index[11] = "m";
	index[12] = "n";
	index[13] = "ks";
	index[14] = "o";
	index[15] = "p";
	index[16] = "r";
	index[17] = "s"; /* s teliko */
	index[18] = "s";
	index[19] = "t";
	index[20] = "y";
	index[21] = "f";
	index[22] = "x";
	index[23] = "ps";
	index[24] = "w";
	/* Upper case letters. (193-217 in iso8859_7) */
	index[25] = "A";
	index[26] = "V";
	index[27] = "G";
	index[28] = "D";
	index[29] = "E";
	index[30] = "Z";
	index[31] = "H";
	index[32] = "8";
	index[33] = "I";
	index[34] = "K";
	index[35] = "L";
	index[36] = "M";
	index[37] = "N";
	index[38] = "KS";
	index[39] = "O";
	index[40] = "P";
	index[41] = "R";
	index[42] = "S";
	index[43] = "T";
	index[44] = "Y";
	index[45] = "F";
	index[46] = "X";
	index[47] = "PS";
	index[48] = "W";
	/*Upper case with accent */
	index[49] = "'A";
	index[50] = "'E";
	index[51] = "'H";
	index[52] = "'I";
	index[53] = "'O";
	index[54] = "'Y";
	index[55] = "'W";
	/*Low case with accent */
	index[56] = "a'";
	index[57] = "e'";
	index[58] = "h'";
	index[59] = "i'";
	index[60] = "o'";
	index[61] = "y'";
	index[62] = "w'";
	/*Special low case */
	index[63] = "i\"";
	index[64] = "y\"";
	index[65] = "i'\"\"";
	index[66] = "y'\"\"";
}
/*The enum that holds the cases for μπ ΜΠ μΠ Μπ ντ ΝΤ νΤ Ντ cases */
enum state {
	b, B, d, D, inactive
};
/*A method that changes the of variable 'currentState' when is needed. */
enum state switchState(int c, enum state currentState) {
	if (c == 236) {
		return b;
	}
	else if (c == 204) {
		return B;
	}
	else if (c == 237) {
		return d;
	}
	else if (c == 205) {
		return D;
	}
	else {
		return inactive;
	}
}
/* Main function that gets a standard input with iso8859-7 characters(from a text file),
translates it to iso8859-1 characters and writes in standard output (in the console). */
int main() {
	enum state currentState = inactive;
	char* character; /* A pointer that points to the element of the array that we want to print. */
	int temp; /* Temporary variable to keep letters numeber ID.*/
	char* letters[67]; /* The array of characters that we are going to use. */
	int c = getchar(); /*The variable that holds the numeber ID of characters*/
	putCharactersInTheArray(letters); /* Store iso8859-1 letters in the array. */

	do {
		if (c < 32) {
			continue; /* That means that the character is not in the iso. */
		}
		/* Find the character we want to change and store it in variable temp . */
		temp = matchCharacter(c);
		/* If the character is the same in both iso we don't need to change something so we take space in memory and we print it as it is. */
		if (temp == -5) {
			character = (char*)malloc(sizeof(char));
			*character = c;
		}
		else { /* We store the letter in pointer character. */
			character = letters[temp];
		}
		
		if (currentState == b) {
			/* π or Π letters */
			if (c == 208 || c == 240) {
				character = "b";
			}
			else {
				print_character("m");
			}
		}
		if (currentState == B) {
			/* π or Π letters */
			if (c == 208 || c == 240) {
				character = "B";
			}
			else {
				print_character("M");
			}
		}
		if (currentState == d) {
			/* τ or Τ letters*/
			if (c == 212 || c == 244) {
				character = "d";
			}
			else {
				print_character("n");
			}
		}
		if (currentState == D) {
			/* τ or Τ letters*/
			if (c == 212 || c == 244) {
				character = "D";
			}
			else {
				print_character("N");
			}
		}
		
		currentState = inactive; /* Initialize the state to inactive */
		/* We switch state if it is needed. */
		currentState = switchState(c, currentState);

		if(currentState == inactive)print_character(character);
	} while ((c = getchar()) != EOF);

	putchar('\n');
	return 0;
}
